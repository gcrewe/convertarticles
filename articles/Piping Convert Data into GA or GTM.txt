Piping Convert Data into GA or GTM
<h2>Summary</h2>
<p>Convert provides different options to send data to GA. One of them is to send data as a string into GA (pipe) for the user to manipulate it and insert it into GA as you please.</p>
<h2>Extracting the Data from your page and sending it to GA</h2>
<p>The data will be sent in the following format as a string in the chose dimension to GA, depending on the number of experiments the user is bucketed on:<br><br><strong>e:experimentid1=v:correspondingvariationid,e:experimentid2=v:correspondingvariationid,e:experimentid3=v:correspondingvariationid</strong></p>
<p>First, you will need to place some code in the Convert app in <strong>Project &gt; Configuration &gt; Global Project Javascript</strong>.<br><br>To send the data to <strong>Google Analytics</strong> or <strong>GTM, </strong> comment and uncomment the shown sections in the code and insert it in your <strong>Global Project Javascript </strong>section.</p>
<pre>console.log("Global code started v1");<br><br>// Run the next code only one time even if called repeateadly<br><br>if (!window.globalExecutedTs) {<br>window.globalExecutedTs = true;<br><br>// First set the trackers for GA to send data in.<br><br>var dataToSend = '';<br><br>// Set the GA dimension you want to store the data in<br><br>var dimension = 1;<br><br>// Declare the function to collect the Convert experiment and variation current data to be sent to GA<br><br>function collectConvertData(_callback) {<br>var exp = convert.currentData.experiments;<br>var number_of_experiments = Object.keys(exp).length;<br>var loop_counter = 0;<br>var reporting_string = "";<br><br>if (number_of_experiments &gt; 0) {<br>for (var expID in exp) {<br>//checking for experiments with &gt;1 var<br>if(Object.keys(convert.data.experiments[expID].vars).length&gt;1){<br>reporting_string = reporting_string + 'e:' + expID + '=' + 'v:' + exp[expID].variation_id;<br><br>if (loop_counter &lt; number_of_experiments - 1) {<br>reporting_string = reporting_string + '|';<br>}<br>}<br>loop_counter++;<br>}<br>// console.log('Experiment data collected: '+reporting_string);<br>dataToSend = reporting_string;<br>_callback(reporting_string); <br>}<br>}<br><br>function sendtoGA(value_to_send,times_called) {<br>if (times_called &lt; 4){<br>if (ga) {<br>// Enable if you want to send the data to GA as an event<br>ga('send', 'event' ,'Convert-Event', 'dimension:'+ dimension + '/' + value_to_send, true);<br>console.log('Experiment Data sent to GA4: ' + value_to_send);<br>} <br>else if (times_called &lt; 4) {<br>setTimeout(function () {<br>times_called++;<br>sendStraightIntoGA4(value_to_send,times_called);<br>}, 50);<br>} <br>}<br>}<br><br>function sendtoGTM(value_to_send,times_called){<br>if (times_called &lt; 4){<br>if (window.dataLayer) {<br>window.dataLayer.push({'ConvertExperiments':reporting_string});<br>console.log('Experiment Data sent to the dataLayer: ' + value_to_send);<br>} <br>else if (times_called &lt; 4) {<br>setTimeout(function () {<br>times_called++;<br>sendtoGTM(value_to_send,times_called);<br>}, 50);<br>} <br>} <br>}<br><br>function sendDataToChannels(data) {<br>// Check if dataToSend is not undefined or an empty string <br>if (typeof data !== "undefined") {<br>if (!(data.length == 0)) {<br>// Comment the one the channel that you are not going to use<br>sendtoGA(data,1);<br>//sendtoGTM(data);<br><br>};<br>}<br>}<br><br><br>function collectAndSendConvertData(){<br>var data<br>collectConvertData(sendDataToChannels);<br>}<br><br><br>_conv_q = window._conv_q || [];<br>_conv_q.push({<br>what: 'addListener',<br>params: {<br>event: 'snippet.experiences_evaluated',<br>handler: (event) =&gt; collectAndSendConvertData()<br>}<br>})<br><br>}</pre>
<p>From here, you can choose how to insert the data into GA. </p>
<p>If using the GA option you will need to create the <strong>Custom Dimension </strong>in GA and address the index in the code as commented.<br><br><img src="https://support.convert.com/hc/article_attachments/360062683671/blobid0.png" alt="blobid0.png"><br><br><img src="https://support.convert.com/hc/article_attachments/360062507532/blobid1.png" alt="blobid1.png"><br><br>Name the dimension. Select <strong>Session </strong>as the Scope, and Save it.<br><br><img src="https://support.convert.com/hc/article_attachments/360062684211/blobid2.png" alt="blobid2.png"><br><br>Lookup the dimension index, and use it in your code for setting it as instructed in the GA code comments.<br><br><img src="https://support.convert.com/hc/article_attachments/360062508112/blobid3.png" alt="blobid3.png"></p>
<p>In this, we would use <strong>'dimension18' </strong>in the code.</p>
<p>Now, you will be able to use the data in GA and GTM as you wish. </p>