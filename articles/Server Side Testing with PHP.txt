Server Side Testing with PHP
<h2>Overview</h2>
<p>This is a sample of PHP code with the purpose to enable AB testing server side. With this code, you should be able to AB test changes, on the server side, before the page has been served to the browser.</p>
<h2>Sample Code</h2>
<p>This code will require that you create a normal Convert AB experiment, and do a small change on it, to be able to save it.</p>
<p>As a suggestion, go into the Visual Editor and under your Variation Menu &gt; Custom Javascript enter the following:</p>
<p>// This is the variation.</p>
<p>With that change, you should be able to save it, and use that experiment to collect data, and analyze it using its report.</p>
<p>Make sure you enter a condition that wont be able to be triggered in the test. You could just use a JS Condition with the value false to never trigger it another way.</p>
<p>To start you will have to find out the <a href="https://support.convert.com/hc/en-us/articles/205160065-How-Do-I-Find-My-Project-Number-">Project Number</a> andÂ <a href="https://support.convert.com/hc/en-us/articles/204506639-Where-Do-I-Find-my-Experiment-and-Variation-IDs" target="_blank" rel="noopener">Experiment id</a>. You need this to include it in the code.</p>
<p>This is way more efficient than getting them via an API, as this would delay the processing of the code. However, if this is what you need, <a href="https://www.convert.com/api/" target="_blank" rel="noopener">we have an API available for you to use</a>.</p>
<p>This code has been fully verified to be deployed with relative few effort.</p>
<pre>&lt;?php<br>// Set the project id and experiment id<br>Define('PROJECTNUMBERID','10014852_10015867');<br>$experimentid = '100122624';<br>$sel_variation = 0;<br>$unknownvseisitor = false;<br>$currentTime = time();<br>$defaultCookieData = "vi:1*sc:0*cs:$currentTime*fs:$currentTime*pv:0";<br><br>// echo 'Cookie Exists:'.(isset($_COOKIE['_conv_v'])).'&lt;br/&gt;';<br>if (!isset($_COOKIE['_conv_v']))<br>{<br><br>echo 'Convert Cookie named _conv_v is not set!';<br> $unknownvisitor = true;<br><br>// Get the variations from the Convert server<br> $projectdataURL = 'https://cdn-3.convertexperiments.com/JSON/'.PROJECTNUMBERID.'.json';<br> $output = file_get_contents($projectdataURL,0,null,null);<br> //echo $output;<br> // if request went well, extract the variations from the returned data and select the variation randomly<br> if ($output) {<br> $projectdata = json_decode($output,true);<br> $experiments = $projectdata['experiments'];<br> $ourexperiment = $experiments[$experimentid];<br> $variations = $ourexperiment['vars_sort'];<br> // Use array_rand to select the variation randomly<br> if (sizeof($variations) &gt; 0) {<br> $sel_var_key = array_rand($variations, 1);<br> $sel_variation = $variations[$sel_var_key];<br> // echo "Variation Key Selected:'$sel_var_key\n";<br> // echo "Variation Selected:'$variations[$sel_var_key]\n";<br> }<br> }<br> $cookieData = $defaultCookieData;<br>}<br>else<br>{<br> // echo 'Convert Cookie is set! Lets read if we have &lt;br /&gt;';<br> // Check if user is bucketed in experiment<br> $convertcookie = (string)$_COOKIE['_conv_v'];<br>// echo 'Convertcookie:'.$convertcookie.'&lt;br/&gt;';<br>// Extracts the experiment from the cookie<br> $sub = substr($convertcookie, strpos($convertcookie,'100122624.{v.')+strlen('100122624.{v.'),strlen($convertcookie));<br> $extractedvariation = substr($sub,0,strpos($sub,'-g.{'));<br>// echo 'Extracted Variation:'.$extractedvariation;<br> if ($extractedvariation){<br> $sel_variation = $extractedvariation;<br> }<br><br>$cookieData = $_COOKIE[$convertCookieName];<br>}<br><br>// Set the Convert Cookie to overcome the ITP cookie browser limits<br>setrawcookie("_conv_v",$cookieData, $currentTime + 15768000, "/", "touristcoin.com");<br>// Set the Selected Variation on the cookie<br>$sptestcookiecontent = $experimentid.':'.$sel_variation;<br>setrawcookie('_conv_sptest',$sptestcookiecontent, $currentTime + 300, "/", "touristcoin.com");<br><br>//Insert the Convert tracking code in case you have not done so.<br> echo '&lt;!-- begin Convert Experiences code--&gt;&lt;script type="text/javascript" src="//cdn-3.convertexperiments.com/js/'.PROJECTNUMBERID.'.js"&gt;&lt;/script&gt;&lt;!-- end Convert Experiences code --&gt;';<br><br><br>// Execute changes depending on the variation<br>echo 'Variation:'.$sel_variation.'&lt;br&gt;';<br><br>if ($sel_variation == '1001176189'){<br><br>// Insert code for corresponding variation<br> echo 'First Variation Selected&lt;br&gt;';<br><br>}<br>elseif ($sel_variation == "1001176190"){<br> // Insert code for corresponding variation<br> echo 'Second Variation Selected&lt;br&gt;';<br>}<br><br>?&gt;</pre>
<p>If you have any questions, let us know through the support channels available to you.</p>